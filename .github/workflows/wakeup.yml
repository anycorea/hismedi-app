name: Wake up Streamlit

on:
  schedule:
    - cron: "0 22 * * *"   # KST 07:00 (UTC 22:00)
  workflow_dispatch:

jobs:
  wakeup:
    runs-on: ubuntu-latest
    steps:
      - name: Wake up multiple Streamlit apps (GET)
        shell: bash
        run: |
          URLS=(
            "https://hismedi-app-nlyfdy5m68hfmnafchqbrr.streamlit.app/"
            "https://hismedi-app-akdbdih2rgeo5pzzkvj2ig.streamlit.app/"
            "https://hismedi-app-a3cyqhakd7fpgnnn3ugezs.streamlit.app/"
            "https://hismedi-app-h6jc8egutxhnhafthftq89.streamlit.app/"
            "https://hisnews-p6tawcdhd7g2xrfgutathk.streamlit.app/"
          )

          UA="Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120 Safari/537.36"

          for URL in "${URLS[@]}"; do
            echo "==> Waking up: $URL"

            # 1) 첫 GET: 부팅 트리거 (부팅이 오래 걸릴 수 있어 timeout 넉넉히)
            CODE1=$(curl -sS -L -A "$UA" -o /dev/null -w "%{http_code}" --max-time 180 "$URL" || echo "curl_error")
            echo "    First hit HTTP: $CODE1"

            # 2) 잠깐 기다렸다가 한 번 더 GET: 실제로 떠 있는지 확인
            sleep 10
            CODE2=$(curl -sS -L -A "$UA" -o /dev/null -w "%{http_code}" --max-time 180 "$URL" || echo "curl_error")
            echo "    Second hit HTTP: $CODE2"
          done

          exit 0
